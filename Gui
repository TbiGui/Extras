ClientData = require(game:GetService("ReplicatedStorage").ClientModules.Core.ClientData)
local LocalPlayer = game.Players.LocalPlayer
local LocalPlayerGui = LocalPlayer:WaitForChild("PlayerGui")
local barWidthScale = 0.05  
local spacingScale = 0.03
local timeInterval = 1  
local maxBars = math.floor(1 / (barWidthScale + spacingScale))  
local bars = {}  
local intervalData = {}  
local minuteData = {}  
local maxCoinsSeen = 25
local previousCoins = ClientData.get_data()[LocalPlayer.Name].money
local EarnedOldBucks = 0
local offsetX = 0.035

local Icons = loadstring(game:HttpGet('https://raw.githubusercontent.com/SiriusSoftwareLtd/Rayfield/refs/heads/main/icons.lua'))()

local function calculateCoinsPerMinute()
	local totalCoins = 0
	-- Berechne die Summe der Coins der letzten Minute
	for _, coins in ipairs(minuteData) do
		totalCoins = totalCoins + coins
	end
	return totalCoins
end

local function rescaleBars()
	maxCoinsSeen = 25
	for _, data in ipairs(intervalData) do
		if math.abs(data) > maxCoinsSeen then
			maxCoinsSeen = math.abs(data)
		end
	end

	for _, barData in ipairs(bars) do
		if math.abs(barData[4]) > maxCoinsSeen then
			maxCoinsSeen = math.abs(barData[4])
		end
	end
end


local function getIcon(name : string)
	name = string.match(string.lower(name), "^%s*(.*)%s*$") :: string
	local sizedicons = Icons['48px']

	local r = sizedicons[name]
	if not r then
		error(`Lucide Icons: Failed to find icon by the name of "{name}"`, 2)
	end

	local rirs = r[2]
	local riro = r[3]

	if type(r[1]) ~= "number" or type(rirs) ~= "table" or type(riro) ~= "table" then
		error("Lucide Icons: Internal error: Invalid auto-generated asset entry")
	end

	local irs = Vector2.new(rirs[1], rirs[2])
	local iro = Vector2.new(riro[1], riro[2])

	local asset = {
		id = r[1],
		imageRectSize = irs,
		imageRectOffset = iro,
	}

	return asset
end

local TbiGuiWindow = {}
TbiGuiWindow.__index = TbiGuiWindow

function TbiGuiWindow.CreateGardient(Gui, ColorSequences)
	local NewGardient = Instance.new("UIGradient")
	NewGardient.Parent = Gui
	NewGardient.Color = ColorSequences
	
	return NewGardient
end

function TbiGuiWindow:CreateDisplay(Section, Icon, Title, Amount)
	local NewDisplay = Instance.new("Frame")
	NewDisplay.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	NewDisplay.BorderSizePixel = 0
	NewDisplay.Size = UDim2.new(1,0,1,0)
	NewDisplay.Parent = Section
	local Gardient = TbiGuiWindow.CreateGardient(NewDisplay, ColorSequence.new{
		ColorSequenceKeypoint.new(0, Color3.fromRGB(25,24,29)),
		ColorSequenceKeypoint.new(0.3, Color3.fromRGB(25,24,29)),
		ColorSequenceKeypoint.new(1, Color3.fromRGB(37,36,41)),
	})
	Gardient.Rotation = -70
	
	local NewAspectRatio = Instance.new("UIAspectRatioConstraint")
	NewAspectRatio.Parent = NewDisplay
	NewAspectRatio.AspectRatio = 5.5
	
	local NewCorner = Instance.new("UICorner")
	NewCorner.Parent = NewDisplay
	NewCorner.CornerRadius = UDim.new(0.15,0)
	
	local NewPadding = Instance.new("UIPadding")
	NewPadding.Parent = NewDisplay
	NewPadding.PaddingBottom = UDim.new(0.1,0)
	NewPadding.PaddingLeft = UDim.new(0.01,0)
	NewPadding.PaddingRight = UDim.new(0.01,0)
	NewPadding.PaddingTop = UDim.new(0.1,0)
	
	local NewList = Instance.new("UIListLayout")
	NewList.Parent = NewDisplay
	NewList.Padding = UDim.new(0.005,0)
	NewList.FillDirection = Enum.FillDirection.Horizontal
	NewList.HorizontalAlignment = Enum.HorizontalAlignment.Center
	NewList.VerticalAlignment = Enum.VerticalAlignment.Center
	NewList.SortOrder = Enum.SortOrder.LayoutOrder
	
	local NewImageLabel = Instance.new("ImageLabel")
	NewImageLabel.Parent = NewDisplay
	NewImageLabel.BackgroundTransparency = 1
	NewImageLabel.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	NewImageLabel.BorderSizePixel = 0
	NewImageLabel.Size = UDim2.new(1,0,1,0)
	NewImageLabel.Position = UDim2.new(0,0,0,0)
	local asset = getIcon(Icon)
	NewImageLabel.Image = 'rbxassetid://'..asset.id
	NewImageLabel.ImageRectOffset = asset.imageRectOffset
	NewImageLabel.ImageRectSize = asset.imageRectSize
	NewImageLabel.ImageColor3 = Color3.fromRGB(255, 255, 255)
	NewImageLabel.LayoutOrder = 1

	local NewAspectRatio2 = Instance.new("UIAspectRatioConstraint")
	NewAspectRatio2.Parent = NewImageLabel
	NewAspectRatio2.AspectRatio = 1

	local NewTextLabel = Instance.new("TextLabel")
	NewTextLabel.Parent = NewDisplay
	NewTextLabel.Size = UDim2.new(0.5,0,1,0)
	NewTextLabel.BackgroundTransparency = 1
	NewTextLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
	NewTextLabel.FontFace.Weight = Enum.FontWeight.Bold
	NewTextLabel.Text = Title
	NewTextLabel.TextScaled = true
	local Gardient2 = TbiGuiWindow.CreateGardient(NewTextLabel, ColorSequence.new{
		ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 255, 255)),
		ColorSequenceKeypoint.new(0.55, Color3.fromRGB(255, 255, 255)),
		ColorSequenceKeypoint.new(1, Color3.fromRGB(208,208,208)),
	})
	Gardient2.Rotation = 90
	NewTextLabel.LayoutOrder = 2
	
	local NewTextLabel2 = Instance.new("TextLabel")
	NewTextLabel2.Parent = NewDisplay
	NewTextLabel2.Size = UDim2.new(0.3,0,1,0)
	NewTextLabel2.BackgroundTransparency = 1
	NewTextLabel2.TextColor3 = Color3.fromRGB(255, 255, 255)
	NewTextLabel2.FontFace.Weight = Enum.FontWeight.Bold
	NewTextLabel2.Text = "(+" .. Amount .. ")"
	NewTextLabel2.TextScaled = true
	local Gardient3 = TbiGuiWindow.CreateGardient(NewTextLabel2, ColorSequence.new{
		ColorSequenceKeypoint.new(0, Color3.fromRGB(85, 255, 0)),
		ColorSequenceKeypoint.new(0.55, Color3.fromRGB(85, 255, 0)),
		ColorSequenceKeypoint.new(1, Color3.fromRGB(62, 186, 0)),
	})
	Gardient3.Rotation = 90
	NewTextLabel2.LayoutOrder = 3
	
	return NewDisplay, NewTextLabel2
end

function TbiGuiWindow:CreateDisplaySection(Section)
	local NewSection = Instance.new("Frame")
	NewSection.Size = UDim2.new(0.45,0,0.9,0)
	NewSection.BackgroundTransparency = 1
	NewSection.Parent = Section
	
	local NewList = Instance.new("UIListLayout")
	NewList.Parent = NewSection
	NewList.Padding = UDim.new(0.025,0)
	NewList.FillDirection = Enum.FillDirection.Vertical
	NewList.HorizontalAlignment = Enum.HorizontalAlignment.Center
	NewList.VerticalAlignment = Enum.VerticalAlignment.Center
	NewList.SortOrder = Enum.SortOrder.LayoutOrder
	
	return NewSection
end

function TbiGuiWindow:CreateSection(Section, Icon, Title)
	local NewSection = Instance.new("Frame")
	NewSection.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	NewSection.BorderSizePixel = 0
	NewSection.Size = UDim2.new(0.5,0,0.5,0)
	NewSection.Parent = Section
	local Gardient = TbiGuiWindow.CreateGardient(NewSection, ColorSequence.new{
		ColorSequenceKeypoint.new(0, Color3.fromRGB(25,24,29)),
		ColorSequenceKeypoint.new(0.3, Color3.fromRGB(25,24,29)),
		ColorSequenceKeypoint.new(1, Color3.fromRGB(37,36,41)),
	})
	Gardient.Rotation = -50
	
	local NewAspectRatio = Instance.new("UIAspectRatioConstraint")
	NewAspectRatio.Parent = NewSection
	NewAspectRatio.AspectRatio = 1.6
	
	local NewCorner = Instance.new("UICorner")
	NewCorner.Parent = NewSection
	NewCorner.CornerRadius = UDim.new(0.05,0)
	
	local NewList = Instance.new("UIListLayout")
	NewList.Parent = NewSection
	NewList.Padding = UDim.new(0,0)
	NewList.HorizontalAlignment = Enum.HorizontalAlignment.Center
	NewList.VerticalAlignment = Enum.VerticalAlignment.Top
	NewList.SortOrder = Enum.SortOrder.LayoutOrder
	
	local NewPadding = Instance.new("UIPadding")
	NewPadding.Parent = NewSection
	NewPadding.PaddingBottom = UDim.new(0.025,0)
	NewPadding.PaddingLeft = UDim.new(0.025,0)
	NewPadding.PaddingRight = UDim.new(0.025,0)
	NewPadding.PaddingTop = UDim.new(0.025,0)
	
	local NewUpperFrame = Instance.new("Frame")
	NewUpperFrame.Parent = NewSection
	NewUpperFrame.BackgroundColor3 = Color3.new(1, 1, 1)
	NewUpperFrame.BackgroundTransparency = 1
	NewUpperFrame.BorderSizePixel = 0
	NewUpperFrame.Size = UDim2.new(1,0,0.2,0)
	NewUpperFrame.LayoutOrder = 1
	
	local NewList2 = Instance.new("UIListLayout")
	NewList2.Parent = NewUpperFrame
	NewList2.Padding = UDim.new(0.015,0)
	NewList2.FillDirection = Enum.FillDirection.Horizontal
	NewList2.HorizontalAlignment = Enum.HorizontalAlignment.Center
	NewList2.VerticalAlignment = Enum.VerticalAlignment.Top
	NewList2.SortOrder = Enum.SortOrder.LayoutOrder
	
	local NewImageLabel = Instance.new("ImageLabel")
	NewImageLabel.Parent = NewUpperFrame
	NewImageLabel.BackgroundTransparency = 1
	NewImageLabel.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	NewImageLabel.BorderSizePixel = 0
	NewImageLabel.Size = UDim2.new(1,0,1,0)
	NewImageLabel.Position = UDim2.new(0,0,0,0)
	local asset = getIcon(Icon)
	NewImageLabel.Image = 'rbxassetid://'..asset.id
	NewImageLabel.ImageRectOffset = asset.imageRectOffset
	NewImageLabel.ImageRectSize = asset.imageRectSize
	NewImageLabel.ImageColor3 = Color3.fromRGB(255, 255, 255)
	NewImageLabel.LayoutOrder = 1
	
	local NewAspectRatio2 = Instance.new("UIAspectRatioConstraint")
	NewAspectRatio2.Parent = NewImageLabel
	NewAspectRatio2.AspectRatio = 1
	
	local NewTextLabel = Instance.new("TextLabel")
	NewTextLabel.Parent = NewUpperFrame
	NewTextLabel.Size = UDim2.new(0.6,0,1,0)
	NewTextLabel.BackgroundTransparency = 1
	NewTextLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
	NewTextLabel.FontFace.Weight = Enum.FontWeight.Bold
	NewTextLabel.Text = Title
	NewTextLabel.TextScaled = true
	local Gardient2 = TbiGuiWindow.CreateGardient(NewTextLabel, ColorSequence.new{
		ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 255, 255)),
		ColorSequenceKeypoint.new(0.55, Color3.fromRGB(255, 255, 255)),
		ColorSequenceKeypoint.new(1, Color3.fromRGB(208,208,208)),
	})
	Gardient2.Rotation = 90
	NewTextLabel.LayoutOrder = 2
	
	local NewFrame = Instance.new("Frame")
	NewFrame.Parent = NewUpperFrame
	NewFrame.BackgroundTransparency = 1
	NewFrame.Size = UDim2.new(0.25,0,1,0)
	NewFrame.LayoutOrder = 3
	
	local NewList3 = Instance.new("UIListLayout")
	NewList3.Parent = NewFrame
	NewList3.Padding = UDim.new(0,0)
	NewList3.FillDirection = Enum.FillDirection.Vertical
	NewList3.HorizontalAlignment = Enum.HorizontalAlignment.Center
	NewList3.VerticalAlignment = Enum.VerticalAlignment.Center
	NewList3.SortOrder = Enum.SortOrder.LayoutOrder
	
	local NewTextLabel2 = Instance.new("TextLabel")
	NewTextLabel2.Parent = NewFrame
	NewTextLabel2.Size = UDim2.new(1,0,0.5,0)
	NewTextLabel2.BackgroundTransparency = 1
	NewTextLabel2.TextColor3 = Color3.fromRGB(255, 255, 255)
	NewTextLabel2.FontFace.Weight = Enum.FontWeight.Bold
	NewTextLabel2.Text = "2000000"
	NewTextLabel2.TextScaled = true
	local Gardient3 = TbiGuiWindow.CreateGardient(NewTextLabel2, ColorSequence.new{
		ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 255, 255)),
		ColorSequenceKeypoint.new(0.55, Color3.fromRGB(255, 255, 255)),
		ColorSequenceKeypoint.new(1, Color3.fromRGB(208,208,208)),
	})
	Gardient3.Rotation = 90
	NewTextLabel2.LayoutOrder = 1
	
	local NewTextLabel3 = Instance.new("TextLabel")
	NewTextLabel3.Parent = NewFrame
	NewTextLabel3.Size = UDim2.new(1,0,0.5,0)
	NewTextLabel3.BackgroundTransparency = 1
	NewTextLabel3.TextColor3 = Color3.fromRGB(255, 255, 255)
	NewTextLabel3.FontFace.Weight = Enum.FontWeight.Bold
	NewTextLabel3.Text = "(+0)"
	NewTextLabel3.TextScaled = true
	local Gardient4 = TbiGuiWindow.CreateGardient(NewTextLabel3, ColorSequence.new{
		ColorSequenceKeypoint.new(0, Color3.fromRGB(85, 255, 0)),
		ColorSequenceKeypoint.new(0.55, Color3.fromRGB(85, 255, 0)),
		ColorSequenceKeypoint.new(1, Color3.fromRGB(62, 186, 0)),
	})
	Gardient4.Rotation = 90
	NewTextLabel3.LayoutOrder = 2
	
	local FrameBelow = Instance.new("Frame")
	FrameBelow.Parent = NewSection
	FrameBelow.BackgroundColor3 = Color3.new(1, 1, 1)
	FrameBelow.BackgroundTransparency = 1
	FrameBelow.BorderSizePixel = 0
	FrameBelow.Size = UDim2.new(1,0,0.75,0)
	FrameBelow.LayoutOrder = 2
	
	local MiddleLine = Instance.new("Frame")
	MiddleLine.Parent = FrameBelow
	MiddleLine.BackgroundColor3 = Color3.fromRGB(76, 76, 76)
	MiddleLine.BorderSizePixel = 0
	MiddleLine.Size = UDim2.new(1,0,0,2)
	MiddleLine.Position = UDim2.new(0,0,0.5,0)
	
	local NewTextLabel4 = Instance.new("TextLabel")
	NewTextLabel4.Parent = FrameBelow
	NewTextLabel4.Size = UDim2.new(0.5,0,0.2,0)
	NewTextLabel4.Position = UDim2.new(0.5,0,0.9,0)
	NewTextLabel4.BackgroundTransparency = 1
	NewTextLabel4.TextColor3 = Color3.fromRGB(255, 255, 255)
	NewTextLabel4.Text = "Coins per minute: 0"
	NewTextLabel4.TextScaled = true
	local Gardient5 = TbiGuiWindow.CreateGardient(NewTextLabel4, ColorSequence.new{
		ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 255, 255)),
		ColorSequenceKeypoint.new(0.55, Color3.fromRGB(255, 255, 255)),
		ColorSequenceKeypoint.new(1, Color3.fromRGB(208,208,208)),
	})
	Gardient5.Rotation = 90
	
	return NewSection, FrameBelow, NewTextLabel4, NewTextLabel2, NewTextLabel3
end

function TbiGuiWindow:CreateTab(Pos, HorizontalAlignment, VerticalAlignment, FillDirection, Padding)
	local NewTab = Instance.new("Frame")
	NewTab.Parent = self.NewWin
	NewTab.Size = UDim2.new(0.47,0,0.9,0)
	NewTab.Position = Pos
	NewTab.BackgroundTransparency = 1
	
	local NewList = Instance.new("UIListLayout")
	NewList.Parent = NewTab
	NewList.Padding = UDim.new(0.05,0)
	NewList.FillDirection = FillDirection
	NewList.HorizontalAlignment = HorizontalAlignment
	NewList.VerticalAlignment = VerticalAlignment
	NewList.SortOrder = Enum.SortOrder.LayoutOrder
	
	if Padding then
		local NewPadding = Instance.new("UIPadding")
		NewPadding.Parent = NewTab
		NewPadding.PaddingBottom = UDim.new(0,0)
		NewPadding.PaddingLeft = UDim.new(0.025,0)
		NewPadding.PaddingRight = UDim.new(0.025,0)
		NewPadding.PaddingTop = UDim.new(0,0)
	end
	
	return NewTab
end

function TbiGuiWindow.CreateWindow(GuiName)
	local win = setmetatable({}, TbiGuiWindow)
	
	win.NewGui = Instance.new("ScreenGui")
	win.NewGui.Parent = LocalPlayerGui
	win.NewGui.Name = GuiName or "Unknown"
	
	win.NewWin = Instance.new("Frame")
	win.NewWin.Parent = win.NewGui
	win.NewWin.BackgroundColor3 = Color3.fromRGB(21, 22, 26)
	win.NewWin.Position = UDim2.new(0,0,0,0)
	win.NewWin.Size = UDim2.new(1,0,1,0)
	win.NewWin.BorderSizePixel = 0
	
	win.LeftSideFrame = Instance.new("Frame")
	win.LeftSideFrame.Parent = win.NewWin
	win.LeftSideFrame.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	win.LeftSideFrame.Size = UDim2.new(0.06,0,0.9,0)
	win.LeftSideFrame.Position = UDim2.new(0,0,0.1,0)
	win.LeftSideFrame.BorderSizePixel = 0
	TbiGuiWindow.CreateGardient(win.LeftSideFrame, ColorSequence.new{
		ColorSequenceKeypoint.new(0, Color3.fromRGB(28,28,33)),
		ColorSequenceKeypoint.new(0.882, Color3.fromRGB(28,28,33)),
		ColorSequenceKeypoint.new(1, Color3.fromRGB(30,29,34)),
	})
	
	win.UpperSideFrame = Instance.new("Frame")
	win.UpperSideFrame.Parent = win.NewWin
	win.UpperSideFrame.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	win.UpperSideFrame.Size = UDim2.new(1,0,0.1,0)
	win.UpperSideFrame.Position = UDim2.new(0,0,0,0)
	win.UpperSideFrame.BorderSizePixel = 0
	TbiGuiWindow.CreateGardient(win.UpperSideFrame, ColorSequence.new{
		ColorSequenceKeypoint.new(0, Color3.fromRGB(28,28,33)),
		ColorSequenceKeypoint.new(0.5, Color3.fromRGB(30,29,34)),
		ColorSequenceKeypoint.new(1, Color3.fromRGB(28,28,33)),
	})
	
	win.UiPadding = Instance.new("UIPadding")
	win.UiPadding.Parent = win.UpperSideFrame
	win.UiPadding.PaddingBottom = UDim.new(0.1,0)
	win.UiPadding.PaddingTop = UDim.new(0.1,0)
	
	win.ImageButton = Instance.new("ImageButton")
	win.ImageButton.Parent = win.UpperSideFrame
	win.ImageButton.Size = UDim2.new(0.1,0,1,0)
	win.ImageButton.Position = UDim2.new(0.952,0,-0.015,0)
	win.ImageButton.BackgroundTransparency = 1
	local asset = getIcon("circle-x")
	win.ImageButton.Image = 'rbxassetid://'..asset.id
	win.ImageButton.ImageRectOffset = asset.imageRectOffset
	win.ImageButton.ImageRectSize = asset.imageRectSize
	win.ImageButton.ImageColor3 = Color3.fromRGB(255, 255, 255)

	win.ImageButton.MouseButton1Down:Connect(function()
		win.ImageButton.ImageColor3 = Color3.fromRGB(0, 255, 255)
		task.wait(0.5)
		win.ImageButton.ImageColor3 = Color3.fromRGB(255, 255, 255)
	end)
	win.ImageButton.MouseButton1Up:Connect(function()
		win.ImageButton.ImageColor3 = Color3.fromRGB(255, 255, 255)
	end)
	win.ImageButton.MouseButton1Click:Connect(function()
		task.wait(0.1)
		win.NewWin.Visible = false
		win.ImagaButton2.Visible = true
	end)
	win.AspectRatio = Instance.new("UIAspectRatioConstraint")
	win.AspectRatio.Parent = win.ImageButton
	win.AspectRatio.AspectRatio = 1
	
	win.ImagaButton2 = Instance.new("ImageButton")
	win.ImagaButton2.Parent = win.NewGui
	win.ImagaButton2.Visible = false
	win.ImagaButton2.Size = UDim2.new(0.1,0,0.1,0)
	win.ImagaButton2.Position = UDim2.new(0.5,0,0.15,0)
	win.ImagaButton2.BackgroundTransparency = 1
	win.ImagaButton2.Image = 'rbxassetid://116531676650470'
	
	local NewAspectRatio = Instance.new("UIAspectRatioConstraint")
	NewAspectRatio.Parent = win.ImagaButton2
	NewAspectRatio.AspectRatio = 1
	
	win.ImagaButton2.MouseButton1Click:Connect(function()
		win.NewWin.Visible = true
		win.ImagaButton2.Visible = false
	end)
	
	print("Window Created!")
	return win
end


local function updateCoins(TotalBucks, EarnedBucks, BucksPerMinuteLabel, chartFrame)
	local currentCoins = ClientData.get_data()[LocalPlayer.Name].money
	TotalBucks.Text = currentCoins
	local coinsInInterval = currentCoins - previousCoins  -- Berechne die Differenz der Coins
	if currentCoins > previousCoins then
		EarnedOldBucks = EarnedOldBucks + (currentCoins - previousCoins)
	end
	
	EarnedBucks.Text = "(+".. EarnedOldBucks ..")"

	-- Füge die Veränderung zu den Intervallen und der Minute hinzu
	table.insert(intervalData, coinsInInterval)
	table.insert(minuteData, coinsInInterval)

	-- Entferne die ältesten Daten, wenn mehr als 60 Einträge vorhanden sind (entspricht einer Minute)
	if #minuteData > 60 then
		table.remove(minuteData, 1)
	end

	previousCoins = currentCoins

	if coinsInInterval == 0 then
		return  -- Nur aktualisieren, wenn sich die Coins geändert haben
	end

	rescaleBars()

	-- Aktualisiere die Anzeige der "Bucks per minute"
	local coinsPerMinute = calculateCoinsPerMinute()
	BucksPerMinuteLabel.Text = "Bucks per minute: " .. tostring(coinsPerMinute)

	if #bars >= maxBars then
		local oldBar = table.remove(bars, 1)
		oldBar[1]:Destroy()
		oldBar[2]:Destroy()
	end

	-- Neuen Balken erstellen
	local bar = Instance.new("Frame")
	bar.Size = UDim2.new(barWidthScale, 0, 0, 0)  -- Anfangsgröße (0 Höhe)
	bar.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	bar.BorderSizePixel = 0
	local newPositionX = offsetX + #bars * (barWidthScale + spacingScale)
	local centerY = 0.5
	bar.Position = UDim2.new(newPositionX, 0, centerY, 0)  -- Startposition
	bar.Parent = chartFrame
	
	local newCorner = Instance.new("UICorner")
	newCorner.Parent = bar
	newCorner.CornerRadius = UDim.new(0.45,0)

	local newGardient = Instance.new("UIGradient")
	newGardient.Parent = bar
	newGardient.Rotation = coinsInInterval >= 0 and 90 or -90
	newGardient.Color = coinsInInterval >= 0 and ColorSequence.new{
		ColorSequenceKeypoint.new(0, Color3.fromRGB(85, 255, 0)),
		ColorSequenceKeypoint.new(0.55, Color3.fromRGB(85, 255, 0)),
		ColorSequenceKeypoint.new(1, Color3.fromRGB(62, 186, 0)),
	} or ColorSequence.new{
		ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 0, 0)),
		ColorSequenceKeypoint.new(0.55, Color3.fromRGB(255, 0, 0)),
		ColorSequenceKeypoint.new(1, Color3.fromRGB(167, 0, 0)),
	}

	-- Berechne die endgültige Höhe und Position des Balkens
	local barHeightScale = math.abs(coinsInInterval) / maxCoinsSeen * 0.4
	local targetPosition = coinsInInterval >= 0 and UDim2.new(newPositionX, 0, centerY - barHeightScale, 0) or UDim2.new(newPositionX, 0, centerY, 0)
	local targetSize = UDim2.new(barWidthScale, 0, barHeightScale, 0)

	-- Animation (Tween) der Größe und Position
	local tweenInfo = TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
	game:GetService("TweenService"):Create(bar, tweenInfo, {Size = targetSize}):Play()
	game:GetService("TweenService"):Create(bar, tweenInfo, {Position = targetPosition}):Play()

	local label = Instance.new("TextLabel")
	label.Size = UDim2.new(barWidthScale, 0, 0.04, 0)  -- Kleinere Label-Größe
	label.Text = tostring(coinsInInterval)  
	label.TextColor3 = Color3.fromRGB(255, 255, 255)
	label.BackgroundTransparency = 1
	label.TextSize = 8  -- Kleinere Schriftgröße
	label.Position = UDim2.new(newPositionX, 0, centerY - 0.06, 0)
	label.Parent = chartFrame

	table.insert(bars, {bar, label, barHeightScale, coinsInInterval})

	-- Bestehende Balken aktualisieren
	for i, barData in ipairs(bars) do
		local bar = barData[1]
		local label = barData[2]
		local height = math.abs(barData[4]) / maxCoinsSeen * 0.4  
		local value = barData[4]
		local newPositionX = offsetX + (i - 1) * (barWidthScale + spacingScale)
		local centerY = 0.5  
		local targetSize, targetPosition, labelPosition

		if value >= 0 then
			targetSize = UDim2.new(barWidthScale, 0, height, 0)
			targetPosition = UDim2.new(newPositionX, 0, centerY - height, 0)  
			labelPosition = UDim2.new(newPositionX, 0, centerY - height - 0.05, 0)
		else
			targetSize = UDim2.new(barWidthScale, 0, height, 0)
			targetPosition = UDim2.new(newPositionX, 0, centerY, 0)  
			labelPosition = UDim2.new(newPositionX, 0, centerY + height, 0)
		end

		local tweenInfo = TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
		game:GetService("TweenService"):Create(bar, tweenInfo, {Size = targetSize}):Play()
		game:GetService("TweenService"):Create(bar, tweenInfo, {Position = targetPosition}):Play()
		game:GetService("TweenService"):Create(label, tweenInfo, {Position = labelPosition}):Play()
	end
end

function TbiGuiWindow.trackCoins(TotalBucks, EarnedBucks, BucksPerMinuteLabel, chartFrame)
	task.spawn(function()
		while true do
			wait(timeInterval)  
			updateCoins(TotalBucks, EarnedBucks, BucksPerMinuteLabel, chartFrame)
			local coinsPerMinute = calculateCoinsPerMinute()
			BucksPerMinuteLabel.Text = "Bucks per minute: " .. tostring(coinsPerMinute)
		end
	end)
end

return TbiGuiWindow
